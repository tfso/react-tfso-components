{"version":3,"sources":["../../src/lib/board/Board.tsx"],"names":["React","BoardContainer","calculateBoardHeight","calculateBoardRows","calculateItemDimensions","calculateItemLayout","compact","moveItem","BoardItemContainer","useWidth","useScreenType","DraggableCore","BoardItemPlaceholder","isEqual","columns","useHeight","screenType","items","spacing","rowHeight","bottomRow","useMemo","height","Board","props","locked","onChange","rootRef","useRef","useState","setItems","activeDrag","setActiveDragItem","oldDragItem","setOldDragItem","placeholder","setPlaceholder","width","setWidth","colWidth","Math","round","boardDimensions","onDragStart","useCallback","key","item","dimensions","dragging","onDrag","_","deltaX","deltaY","top","max","left","min","itemLayout","newDragItem","newItems","col","row","onDragStop","Object","values","map","layout","containerProps","Component","component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport BoardContainer from './BoardContainer'\nimport {BoardItems, ScreenType, BoardItem} from './types'\nimport {calculateBoardHeight, calculateBoardRows, calculateItemDimensions, calculateItemLayout, compact, moveItem} from './utils'\nimport BoardItemContainer, {BoardItemContainerProps} from './BoardItemContainer'\nimport {useWidth} from './useWidth'\nimport useScreenType from './useScreenType'\nimport {DraggableCore, DraggableData, DraggableEvent} from 'react-draggable'\nimport BoardItemPlaceholder, {BoardItemPlaceholdProps} from './BoardItemPlaceholder'\nimport isEqual from 'lodash/isEqual'\n\nexport type BoardProps = {\n    locked?: boolean\n    items: BoardItems\n    spacing?: number\n    rowHeight: number\n    onChange?: (items: BoardItems) => void\n    children?: undefined\n}\n\nconst columns = 12\n\nconst useHeight = (\n    {items, spacing = 0, rowHeight}: Pick<BoardProps, 'items'|'spacing'|'rowHeight'>,\n    screenType: ScreenType\n) => {\n    const bottomRow = React.useMemo(() => calculateBoardRows(items, screenType), [items, screenType])\n    const height = React.useMemo(() => calculateBoardHeight(bottomRow, spacing, rowHeight), [bottomRow, spacing, rowHeight])\n    return height\n}\n\nconst Board = (props: BoardProps) => {\n    const {spacing = 0, rowHeight, locked, onChange} = props\n    const rootRef = React.useRef<HTMLDivElement>(null)\n\n    // State\n    const [items, setItems] = React.useState(props.items)\n    const [activeDrag, setActiveDragItem] = React.useState<BoardItemContainerProps & {key: React.Key} | null>(null)\n    const [oldDragItem, setOldDragItem] = React.useState<BoardItem | null>(null)\n    const [placeholder, setPlaceholder] = React.useState<BoardItemPlaceholdProps | null>(null)\n    const [width, setWidth] = React.useState(1920)\n\n    // Board dimensions\n    useWidth(rootRef, (width) => setWidth(width))\n    const screenType = useScreenType(width)\n    const height = useHeight(props, screenType)\n    const colWidth = React.useMemo(() => Math.round((width + spacing) / (columns)) - spacing, [spacing, width])\n    const boardDimensions = React.useMemo(() => ({rowHeight, colWidth, spacing}), [rowHeight, colWidth, spacing])\n\n    // Callbacks\n    const onDragStart = React.useCallback((key: React.Key) => {\n        const item = {...items[key]}\n        const dimensions = calculateItemDimensions(item[screenType]!, boardDimensions)\n        setActiveDragItem({...dimensions, key, dragging: true})\n        setOldDragItem(item)\n    }, [items, screenType, boardDimensions])\n\n    const onDrag = React.useCallback((_: DraggableEvent, {deltaX, deltaY}: DraggableData) => {\n        if(!activeDrag) return\n\n        // Constraining movement to within the container bounds\n        const top = Math.max(activeDrag.top + deltaY, 0)\n        const left = Math.min(Math.max(activeDrag.left + deltaX, 0), width - activeDrag.width)\n\n        const item = {...items[activeDrag.key]}\n        const itemLayout = calculateItemLayout(item[screenType]!, {top, left}, boardDimensions)\n\n        // TODO: Move items out of collisions.\n        const newDragItem = {...activeDrag, top, left}\n        const newItems = compact(\n            moveItem(newDragItem.key, items, itemLayout.col, itemLayout.row, screenType),\n            screenType)\n        setItems(newItems)\n        setActiveDragItem({...activeDrag, top, left})\n        setPlaceholder(calculateItemDimensions(newItems[activeDrag.key][screenType]!, boardDimensions))\n    }, [activeDrag, items, screenType, boardDimensions, width])\n\n    const onDragStop = React.useCallback(() => {\n        if(!activeDrag){\n            return\n        }\n        const {key} = activeDrag\n        const item = {...items[key], [screenType]: calculateItemLayout(items[key][screenType]!, activeDrag, boardDimensions)}\n        const newItems = compact({...items, [activeDrag.key]: item}, screenType)\n        setItems(newItems)\n\n        if(onChange && !isEqual(item, oldDragItem)){\n            onChange(newItems)\n        }\n\n        setActiveDragItem(null)\n        setPlaceholder(null)\n    }, [activeDrag, oldDragItem, items, screenType, boardDimensions, onChange, screenType])\n\n    return (\n        <div ref={rootRef}>\n            <BoardContainer height={height}>\n                {Object.values(items).map(item => {\n                    const layout = item[screenType]\n                    if(!layout){\n                        return null\n                    }\n                    const containerProps = activeDrag && activeDrag.key === item.key\n                        ? activeDrag\n                        : calculateItemDimensions(layout, boardDimensions)\n\n                    const Component = item.component\n                    return locked ? (\n                        <BoardItemContainer {...containerProps} key={item.key}>\n                            <Component screenType={screenType} />\n                        </BoardItemContainer>\n                    ) : (\n                        <DraggableCore\n                            key={item.key}\n                            onStart={() => onDragStart(item.key)}\n                            onDrag={onDrag}\n                            onStop={onDragStop}\n                        >\n                            <BoardItemContainer {...containerProps}>\n                                <Component screenType={screenType} />\n                            </BoardItemContainer>\n                        </DraggableCore>\n                    )\n                })}\n                {placeholder && <BoardItemPlaceholder {...placeholder} />}\n            </BoardContainer>\n        </div>\n    )\n}\n\nBoard.propTypes = {\n    items: PropTypes.object.isRequired,\n    locked: PropTypes.bool,\n    onChange: PropTypes.func,\n    rowHeight: PropTypes.number.isRequired,\n    spacing: PropTypes.number,\n}\n\nexport default Board"],"file":"Board.js"}